import{_ as s,c as a,o as n,as as h}from"./chunks/framework.B-x_5eXW.js";const c=JSON.parse('{"title":"Verdaccio 搭建 NPM 私有仓库","description":"","frontmatter":{},"headers":[],"relativePath":"posts/Verdaccio搭建NPM私有仓库.md","filePath":"posts/Verdaccio搭建NPM私有仓库.md","lastUpdated":1755930479000}'),t={name:"posts/Verdaccio搭建NPM私有仓库.md"};function l(e,i,p,k,r,d){return n(),a("div",null,i[0]||(i[0]=[h(`<h1 id="verdaccio-搭建-npm-私有仓库" tabindex="-1">Verdaccio 搭建 NPM 私有仓库 <a class="header-anchor" href="#verdaccio-搭建-npm-私有仓库" aria-label="Permalink to &quot;Verdaccio 搭建 NPM 私有仓库&quot;">​</a></h1><p>Verdaccio 是一个开源的、轻量级的私有 npm 仓库管理器，允许开发团队在本地环境中搭建一个专属的 NPM 仓库</p><p>用于存储和管理项目的依赖包，有利于在公司内部管理多个自定义包，确保稳定性和安全性</p><p>前置条件：服务器需要安装上 Node、NPM、PM2</p><p>以下操作是在本地虚拟器上测试：</p><h2 id="配置阶段" tabindex="-1">配置阶段 <a class="header-anchor" href="#配置阶段" aria-label="Permalink to &quot;配置阶段&quot;">​</a></h2><h3 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h3><ol><li>在服务器上安装 Verdaccio：<code>npm install verdaccio -g</code></li></ol><h3 id="测试" tabindex="-1">测试 <a class="header-anchor" href="#测试" aria-label="Permalink to &quot;测试&quot;">​</a></h3><p>执行命令 <code>verdaccio</code>，默认会在服务器本地上启动 Verdaccio，后续会使用 PM2</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[root@iZbp12s6n1dclq79esxf2oZ /] verdaccio</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node:46828</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Warning:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Verdaccio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> doesn&#39;t need superuser privileges. don&#39;t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> under</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --trace-warnings</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ...\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> show</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> warning</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> was</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node:46828</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Warning:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Verdaccio</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> doesn&#39;t need superuser privileges. don&#39;t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> under</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/verdaccio/config.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;crypt&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> algorithm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deprecated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> consider</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> switch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bcrypt&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Read</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> documentation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> additional</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> details</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> using</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> htpasswd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/verdaccio/htpasswd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> plugin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio-htpasswd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">info</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> plugin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> successfully</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio-audit</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:4873/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> verdaccio/5.26.2</span></span></code></pre></div><h3 id="配置-verdaccio" tabindex="-1">配置 Verdaccio <a class="header-anchor" href="#配置-verdaccio" aria-label="Permalink to &quot;配置 Verdaccio&quot;">​</a></h3><p>在 Verdaccio 文件夹中找到配置文件 config.yaml 在最后一行添加内容。之后就重启它</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;!-- vi /usr/verdaccio/config.yaml  --&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&lt;!-- 也可以修改它的端口号 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0.0.0.0:4873</span></span></code></pre></div><h2 id="使用阶段" tabindex="-1">使用阶段 <a class="header-anchor" href="#使用阶段" aria-label="Permalink to &quot;使用阶段&quot;">​</a></h2><h3 id="使用切换源地址" tabindex="-1">使用切换源地址 <a class="header-anchor" href="#使用切换源地址" aria-label="Permalink to &quot;使用切换源地址&quot;">​</a></h3><p>当我们的私有仓库服务在服务器上开始跑后，之后安装依赖都通过这个私有仓库去按照。</p><p>这个时候就需要切换我们本地的NPM源地址，需要安装一个包叫 NRM</p><p>NRM（NPM Registry Manager）是一个用于​​快速切换镜像源​​的 Node.js 命令行工具。它可以帮助开发者轻松地在不同的 NPM 注册表（如官方 NPM、淘宝镜像、私有 Verdaccio 仓库等）之间切换，而无需手动修改 NPM 配置。</p><p>执行命令：</p><ul><li><code>nrm ls</code> 查看当前所有源</li><li><code>nrm add</code> 源名称 服务器IP 添加源</li><li><code>nrm use</code> 源名称切换源</li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35988724/1699622056243-382d3ac1-0b13-4e23-9aac-7e2a56419a67.png" alt="" data-fancybox="gallery"></p><h3 id="添加用户" tabindex="-1">添加用户 <a class="header-anchor" href="#添加用户" aria-label="Permalink to &quot;添加用户&quot;">​</a></h3><p>我们如果需要向私有仓库发布NPM包，那么就需要有一个用户。</p><ul><li><code>npm adduser --registry 服务器IP</code></li></ul><p>执行上诉命令，之后会让我们输入用户名、密码和邮箱，之后我们在使用命令 <code>npm whoami</code> 查看当前登录用户的名称是否为新增用户的账号或者也可以尝试登录 Verdaccio 的页面</p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35988724/1699622286602-383321e4-9587-42c0-b809-0899523e2ce2.png" alt="" data-fancybox="gallery"></p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35988724/1699622348150-9dba8ed4-1a40-4a19-9203-1f01fa893f53.png" alt="" data-fancybox="gallery"></p><h3 id="发布包" tabindex="-1">发布包 <a class="header-anchor" href="#发布包" aria-label="Permalink to &quot;发布包&quot;">​</a></h3><p>在发包之前，首先先确定源地址已经切换。之后执行 <code>npm publish</code> 直接发布即可</p><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35988724/1699622748650-4fcd0f1b-4879-460e-9996-c57ae8ffcac6.png" alt="" data-fancybox="gallery"></p><h3 id="安装包" tabindex="-1">安装包 <a class="header-anchor" href="#安装包" aria-label="Permalink to &quot;安装包&quot;">​</a></h3><p>如果是私有仓库中存在的包则会安装私有仓库里的包</p><p>如果安装的包不在私有仓库中，则会从NPM中寻找依赖包进行安装</p><h2 id="pm2" tabindex="-1">PM2 <a class="header-anchor" href="#pm2" aria-label="Permalink to &quot;PM2&quot;">​</a></h2><p>PM2 是一个守护进程管理工具，帮助您管理和守护您的应用程序。它以简单直观的 CLI 命令行方式进行工作。</p><ul><li><code>npm install pm2 -g</code></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35988724/1699624097417-4a343bc1-a8bb-407a-a40e-341a14628c22.png" alt="" data-fancybox="gallery"></p><p>之后Verdaccio就会一直在运行状态了</p>`,39)]))}const o=s(t,[["render",l]]);export{c as __pageData,o as default};
