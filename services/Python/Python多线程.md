---
title: Python多线程
tags:
  - Python
categories:
  - 记录学习-成长
---

## 多任务

1. 多任务介绍

例如： 百度网盘同时下载多个文件或视频。

好处： 充分利用 CPU 资源，提高程序的执行效率

2. 多任务 2 种表现形式

- 并发 （在一段时间内 交替 去执行多个任务）

例子： 对于单核 cpu 处理多任务，操作系统会轮流让各个任务**交替执行**

- 并行 (同时执行多个任务)

## 多进程

1. 进程

   - 通俗理解： 一个正在进行的程序就是一个进程。例如：正在允许的 QQ 或 微信。

2. 多进程

   1. 程序运行会默认创建一个进程，这个默认创建的进程称为 **主进程**

   2. 程序运行后又创建一个进程，这个称为 **子进程**

3. 多进程完成多任务

   ```py
   1. 导入进程包
   import multiprocessing

   2. 通过进程类创建进程对象
   进程对象xxx = multiprocessing.Process(target=任务名, [args]|[kwargs], [name], [group])
       args 进行执行需要携带参数时。（以元组的方式给任务传参）
       kwargs 进行执行需要携带参数时。（以字典的方式给任务传参）
       name 进程名，一般不用设置
       group 进程组，目前只能使用None

   3. 启动进程执行任务
   进程对象xxx.start()
   ```

4. 关于进程编号

   - 进程编号的作用： 当程序的数量越来越多时，如果没有办法区分主进程和子进程还有不同的子进程， 那么就无法进行有效的进程管理，为了方便管理实际上每个进程都是有自己的编号。

   ```py
   1. 获取当前进程编号

   pid = os.getpid()

   2. 获取当前父进程编号 （创建进程的 父进程）

   ppid = os.getppid()
   ```

5. 多进程的注意点

   - 主进程会等待使用子进程执行结合再结束

   现在我们要 **主进程退出后，子进程直接销毁，不再执行子进程的代码**。 我们需要设置 **守护主进程**。 只需要给 子进程下的 daemon 的属性设置为 True 即可。

   ```py
   # 创建 子进程 后
   xxx = multiprocessing.Process(target=任务名)

   # 设置 守护主进程
   xxx.daemon = True

   # 启动进程
   xxx.start()
   ```

## 多线程

1. 线程

   线程是**程序执行最小单位**， 实际上进程只负责分配资源， 而利用这些资源执行程序的是线程， 也就是说进程是线程的容器， **一个进程中最少有一个线程来**负责执行程序，同时线程自己不拥有系统资源， 只需要一点儿再运行中必不可少的资源，但它可与同属一个进程的其他线程**共享进程所用有的全部资源**。 这就像一个 QQ 软件（一个进程）打开两个窗口（两个线程）和两个人聊天一样， 实现多任务的同时也节省了资源。

2. 多线程的作用

   - 在进程中默认会有一个线程用来执行程序， 这个线程称为**主线程**

   - 在进程中创建一个新的线程，这个线程称为**子线程**

3. 多线程实现多任务

   ```py
   1. 导入线程模块
   import threading

   2. 通过线程类创建线程对象
   线程对象xxx = threading.Thread(target=任务名, [args]|[kwargs], [name], [group])
      args 进行执行需要携带参数时。（以元组的方式给任务传参）
      kwargs 进行执行需要携带参数时。（以字典的方式给任务传参）
      name 进程名，一般不用设置
      group 进程组，目前只能使用None

   3. 启动线程执行任务
   线程对象xxx.start()
   ```

4. 主线程和子线程的结束顺序

   对比进程：

   - 主线程会等待所有子线程执行结束后主线程在结束

   设置守护主线程： 实现主线程不等待子线程程序执行完再结束

   - ```py
      1. 设置守护主线程：方式 1 在创建线程设置 daemon = True
      线程对象 xxx = threading.Thread(target = 任务名, daemon = True)

      2. 设置守护主线程： 方式 2 在创建线程后 设置 .setDaemon(True)
      线程对象 xxx.setDaemon(True)
     ```

5. 线程之间的执行顺序

   - 是无序的

   - 获取当前线程的对象

     - 通过 .current_thread() 方法获取线程对象 thread = threading.current_thread()

## 进程和线程对比

1. 关系对比

   - 线程是依附在进程里面的， 没有进程就没有线程

   - 一个进程默认提供一条线程， 进程可以创建多个线程

2. 区别对比

   - 创建进程的资源开销要比创建线程的资源开销大

   - 进程是操作系统资源分配的基本单位， 线程是 CPU 调度的基本单位

   - 线程不能够独立执行， 必须依存在进程中

3. 优缺点对比

   - 进程

     - 优点： 可以用多核
     - 缺点： 资源开销大

   - 线程

     - 优点： 资源开销小
     - 缺点： 不能使用多核
